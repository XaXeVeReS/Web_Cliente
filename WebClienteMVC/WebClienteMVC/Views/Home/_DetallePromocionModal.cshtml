@model List<WebClienteMVC.WCF_Apl_Dis.Cls_Promocion_Plato>

@{
    var promo = Model.First();
    int stock = ViewBag.Stock != null ? (int)ViewBag.Stock : 0;
}

<div class="modal fade" id="modalPromo" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content shadow-lg" style="border-radius:18px; overflow:hidden;">

            <!-- HEADER -->
            <div class="modal-header bg-warning text-dark">
                <h4 class="modal-title fw-bold">
                    @promo.PromocionNombre
                </h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <!-- BODY -->
            <div class="modal-body">

                <div class="row">

                    <!-- IMAGEN PRINCIPAL -->
                    <div class="col-md-5 d-flex align-items-start justify-content-center mb-3">
                        <img src="@(promo.Imagen != null
                                ? "data:image/png;base64," + Convert.ToBase64String(promo.Imagen)
                                : Url.Content("~/Recursos/no-imagen.png"))"
                             class="img-fluid rounded shadow"
                             style="object-fit:cover; width:100%; max-height:260px;" />
                    </div>

                    <!-- INFORMACIÓN -->
                    <div class="col-md-7">

                        <p class="fs-5"><strong>Descripción:</strong> @promo.Descripcion</p>

                        <div class="mt-3 mb-2 p-3 bg-light border rounded">
                            <p class="m-0 fs-5">
                                <strong>Descuento:</strong>
                                <span class="text-danger fw-bold">@((promo.Descuento * 100).ToString("0"))%</span>
                            </p>

                            <p class="m-0 fs-5">
                                <strong>Mínimo requerido:</strong>
                                <span class="text-primary fw-bold">@promo.Cantidad_Aplicable platos</span>
                            </p>

                            <p class="m-0 fs-5">
                                <strong>Vigencia:</strong>
                                <span>
                                    @promo.Fecha_Inicio.ToString("dddd dd, hh:mm tt").ToLower() hasta el
                                    @promo.Fecha_Fin.ToString("dddd dd, hh:mm tt").ToLower()
                                </span>
                            </p>

                            <p class="m-0 fs-5">
                                <strong>Stock disponible:</strong>
                                <span class="text-success fw-bold">@stock</span>
                            </p>
                        </div>

                        <!-- Precios -->
                        <div class="mt-3">
                            <p class="text-decoration-line-through text-danger fs-6 mb-1">
                                Precio normal: S/ @promo.PrecioNormal.ToString("0.00")
                            </p>

                            <p class="text-success fw-bold fs-4">
                                Precio con descuento: S/ @promo.PrecioConDescuento.ToString("0.00")
                            </p>
                        </div>

                        <!-- SELECTOR DE CANTIDAD -->
                        <div class="d-flex align-items-center gap-3 mt-3">
                            <button class="btn btn-outline-dark px-3 fs-4"
                                    onclick="cambiarCantidadPromo(-1)">
                                −
                            </button>

                            <input id="cantidadPromo"
                                   type="text"
                                   value="1"
                                   class="form-control text-center fw-bold fs-5"
                                   style="width:80px;"
                                   readonly />

                            <button class="btn btn-outline-dark px-3 fs-4"
                                    onclick="cambiarCantidadPromo(1)">
                                +
                            </button>
                        </div>

                    </div>
                </div>

            </div>

            <!-- FOOTER -->
            <div class="modal-footer d-flex justify-content-between">

                <button class="btn btn-secondary px-4" data-bs-dismiss="modal">
                    Cerrar
                </button>

                <button class="btn btn-warning fw-bold px-4 fs-5"
                        onclick="confirmarAgregarPromo(
                                @promo.Id_Plato,
                                '@promo.PromocionNombre',
                                @promo.Descuento,
                                @promo.PrecioConDescuento,
                                @promo.Id_Promocion
                            )">
                    ➕ Agregar Promoción
                </button>

            </div>

        </div>
    </div>
</div>


<script>
    function cambiarCantidadPromo(n) {
        let input = document.getElementById("cantidadPromo");
        let v = parseInt(input.value);

        if (v + n >= 1)
            input.value = v + n;
    }

    function confirmarAgregarPromo(idplato, nombrePromo, descuento, precioConDescuento, idpromo) {
        let cant = parseInt(document.getElementById("cantidadPromo").value);

        agregarAComprasPromo(idplato, nombrePromo, descuento, precioConDescuento, cant, idpromo);

        let modal = bootstrap.Modal.getInstance(document.getElementById("modalPromo"));
        modal.hide();
    }

</script>
